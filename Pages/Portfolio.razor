@page "/portfolio"
@using StockApp.Models;
@using StockApp.Clients;
@inject StockClient StockClient;

<PageTitle>Watch List</PageTitle>


<div class="container px-4 px-lg-5">
    <div class="row">
        <div class="col-md-6">

            <br>
            <p>Please enter a valid <b>stock acronym</b>:</p>

            <div class="form-group row">
                <div class="col-md-9">
                    <input placeholder="Enter stock acronym" @bind-value="@enteredStock" class="form-control"/>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary" @onclick="AddStock">Lookup</button>
                </div>
            </div>

            <br>

            <p>Please enter a valid <b>stock code</b>:</p>

            <div class="form-group row">
                <div class="col-md-9">
                    <input placeholder="Enter stock code" @bind-value="@enteredCode" class="form-control"/>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary" @onclick="AddCode">Lookup</button>
                </div>
            </div>

            <br>

            <p>Please enter a valid <b>currency</b> (Give up to 20 sec. with some searches):</p>

            <div class="form-group row">
                <div class="col-md-9">
                    <input placeholder="Enter currency" @bind-value="@enteredCurrency" class="form-control"/>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary" @onclick="AddCurrency">Lookup</button>
                </div>
            </div>

            <br>

            <p>Please enter a valid <b>exchange</b> (Give up to 5 sec. with some searches):</p>

            <div class="form-group row">
                <div class="col-md-9">
                    <input placeholder="Enter exchange" @bind-value="@enteredExchange" class="form-control"/>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary" @onclick="AddExchange">Lookup</button>
                </div>
            </div>

            <br>

            @if (stockResponseWatchList != null)
            {
                <h3>Stock Information</h3>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Symbol</th>
                                <th>Name</th>
                                <th>Currency</th>
                                <th>Exchange</th>
                                <th>Mic Code</th>
                                <th>Country</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (stockResponseWatchList.theData != null)
                            {
                                @foreach (var value in stockResponseWatchList.theData)
                                {
                                    <tr>
                                        <td>@value.theSymbol</td>
                                        <td>@value.theName</td>
                                        <td>@value.theCurrency</td>
                                        <td>@value.theExchange</td>
                                        <td>@value.theMic_Code</td>
                                        <td>@value.theCountry</td>
                                        <td>@value.theType</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="7">No stocks in watch list</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>




@code {

    private StockResponseWatchList? stockResponseWatchList = null;

    protected override async Task OnInitializedAsync()
    {
        stockResponseWatchList = await StockClient.GetAllStocks(null);
    }

    private string? enteredStock;
    private string? enteredCode;
    private string? enteredCurrency;
    private string? enteredExchange;

    protected async Task AddStock()
    {
        if (enteredStock != null)
        {
            stockResponseWatchList = await StockClient.GetAllStocks(enteredStock);
        }
    }

    protected async Task AddCode()
    {
        if (enteredCode != null)
        {
            stockResponseWatchList = await StockClient.GetStockCode(enteredCode);
        }
    }

    protected async Task AddCurrency()
    {
        if (enteredCurrency != null)
        {
            stockResponseWatchList = await StockClient.GetCurrency(enteredCurrency);
        }
    }

    protected async Task AddExchange()
    {
        if (enteredExchange != null)
        {
            stockResponseWatchList = await StockClient.GetExchange(enteredExchange);
        }
    }
}
